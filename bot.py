"""
Telegram –±–æ—Ç SchoolHelperBot –¥–ª—è –ø–æ–º–æ—â–∏ –ø–æ —Ñ–∏–∑–∏–∫–µ 9 –∫–ª–∞—Å—Å–∞
"""
import os
import logging
import asyncio
import random
from dotenv import load_dotenv
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes, CallbackQueryHandler

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
BOT_TOKEN = os.getenv('BOT_TOKEN', '')

if not BOT_TOKEN:
    logger.error("BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ .env —Ñ–∞–π–ª")
    raise ValueError("BOT_TOKEN –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞")


# ==================== –ë–ê–ó–ê –î–ê–ù–ù–´–• –§–û–†–ú–£–õ ====================

FORMULAS_DB = {
    '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞': {
        '—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ': {
            'formula': 'v = s/t',
            'description': '–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ —Ä–∞–≤–Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –ø—É—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–∏.',
            'variables': {'v': '—Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)', 's': '–ø—É—Ç—å (–º)', 't': '–≤—Ä–µ–º—è (—Å)'}
        },
        '–ø—É—Ç—å': {
            'formula': 's = v¬∑t',
            'description': '–ü—É—Ç—å –ø—Ä–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ —Ä–∞–≤–µ–Ω –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ –≤—Ä–µ–º—è.',
            'variables': {'s': '–ø—É—Ç—å (–º)', 'v': '—Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)', 't': '–≤—Ä–µ–º—è (—Å)'}
        },
        '—Ä–∞–≤–Ω–æ—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ': {
            'formula': 'v = v‚ÇÄ + at\ns = v‚ÇÄt + at¬≤/2',
            'description': '–†–∞–≤–Ω–æ—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ - –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º.',
            'variables': {'v': '–∫–æ–Ω–µ—á–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)', 'v‚ÇÄ': '–Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)', 
                         'a': '—É—Å–∫–æ—Ä–µ–Ω–∏–µ (–º/—Å¬≤)', 't': '–≤—Ä–µ–º—è (—Å)', 's': '–ø—É—Ç—å (–º)'}
        },
        '—Å–≤–æ–±–æ–¥–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ': {
            'formula': 'v = gt\nh = gt¬≤/2',
            'description': '–°–≤–æ–±–æ–¥–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ - –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º —Å–∏–ª—ã —Ç—è–∂–µ—Å—Ç–∏.',
            'variables': {'v': '—Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)', 'g': '—É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è ‚âà 9,8 –º/—Å¬≤',
                         't': '–≤—Ä–µ–º—è (—Å)', 'h': '–≤—ã—Å–æ—Ç–∞ (–º)'}
        }
    },
    '–¥–∏–Ω–∞–º–∏–∫–∞': {
        '–≤—Ç–æ—Ä–æ–π –∑–∞–∫–æ–Ω –Ω—å—é—Ç–æ–Ω–∞': {
            'formula': 'F = ma',
            'description': '–°–∏–ª–∞ —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –º–∞—Å—Å—ã –Ω–∞ —É—Å–∫–æ—Ä–µ–Ω–∏–µ.',
            'variables': {'F': '—Å–∏–ª–∞ (–ù)', 'm': '–º–∞—Å—Å–∞ (–∫–≥)', 'a': '—É—Å–∫–æ—Ä–µ–Ω–∏–µ (–º/—Å¬≤)'}
        },
        '—Å–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏': {
            'formula': 'F = mg',
            'description': '–°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏ —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –º–∞—Å—Å—ã –Ω–∞ —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è.',
            'variables': {'F': '—Å–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏ (–ù)', 'm': '–º–∞—Å—Å–∞ (–∫–≥)', 'g': '—É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è ‚âà 9,8 –º/—Å¬≤'}
        },
        '—Å–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è': {
            'formula': 'F—Ç—Ä = ŒºN',
            'description': '–°–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è —Å–∫–æ–ª—å–∂–µ–Ω–∏—è —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Ç—Ä–µ–Ω–∏—è –Ω–∞ —Å–∏–ª—É –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏.',
            'variables': {'F—Ç—Ä': '—Å–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è (–ù)', 'Œº': '–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç—Ä–µ–Ω–∏—è', 'N': '—Å–∏–ª–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏ (–ù)'}
        },
        '—Å–∏–ª–∞ —É–ø—Ä—É–≥–æ—Å—Ç–∏': {
            'formula': 'F = -kx',
            'description': '–°–∏–ª–∞ —É–ø—Ä—É–≥–æ—Å—Ç–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–∑–∞–∫–æ–Ω –ì—É–∫–∞).',
            'variables': {'F': '—Å–∏–ª–∞ —É–ø—Ä—É–≥–æ—Å—Ç–∏ (–ù)', 'k': '–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∂–µ—Å—Ç–∫–æ—Å—Ç–∏ (–ù/–º)', 'x': '–¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è (–º)'}
        }
    },
    '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è': {
        '–∏–º–ø—É–ª—å—Å': {
            'formula': 'p = mv',
            'description': '–ò–º–ø—É–ª—å—Å —Ç–µ–ª–∞ —Ä–∞–≤–µ–Ω –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –º–∞—Å—Å—ã –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å.',
            'variables': {'p': '–∏–º–ø—É–ª—å—Å (–∫–≥¬∑–º/—Å)', 'm': '–º–∞—Å—Å–∞ (–∫–≥)', 'v': '—Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)'}
        },
        '–∑–∞–∫–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–ø—É–ª—å—Å–∞': {
            'formula': 'm‚ÇÅv‚ÇÅ + m‚ÇÇv‚ÇÇ = m‚ÇÅv‚ÇÅ\' + m‚ÇÇv‚ÇÇ\'',
            'description': '–í –∑–∞–º–∫–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ —Å—É–º–º–∞ –∏–º–ø—É–ª—å—Å–æ–≤ –¥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Ä–∞–≤–Ω–∞ —Å—É–º–º–µ –∏–º–ø—É–ª—å—Å–æ–≤ –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.',
            'variables': {'m‚ÇÅ, m‚ÇÇ': '–º–∞—Å—Å—ã —Ç–µ–ª (–∫–≥)', 'v‚ÇÅ, v‚ÇÇ': '—Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (–º/—Å)',
                         'v‚ÇÅ\', v‚ÇÇ\'': '—Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (–º/—Å)'}
        },
        '–∫–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è': {
            'formula': 'Ek = mv¬≤/2',
            'description': '–ö–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è —Ä–∞–≤–Ω–∞ –ø–æ–ª–æ–≤–∏–Ω–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º–∞—Å—Å—ã –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏.',
            'variables': {'Ek': '–∫–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è (–î–∂)', 'm': '–º–∞—Å—Å–∞ (–∫–≥)', 'v': '—Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)'}
        },
        '–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è': {
            'formula': 'Ep = mgh',
            'description': '–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è —Ç–µ–ª–∞ –≤ –ø–æ–ª–µ —Ç—è–∂–µ—Å—Ç–∏ —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –º–∞—Å—Å—ã, —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è –∏ –≤—ã—Å–æ—Ç—ã.',
            'variables': {'Ep': '–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è (–î–∂)', 'm': '–º–∞—Å—Å–∞ (–∫–≥)', 
                         'g': '—É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è ‚âà 9,8 –º/—Å¬≤', 'h': '–≤—ã—Å–æ—Ç–∞ (–º)'}
        },
        '–∑–∞–∫–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏': {
            'formula': 'Ek‚ÇÅ + Ep‚ÇÅ = Ek‚ÇÇ + Ep‚ÇÇ',
            'description': '–í –∑–∞–º–∫–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ–ª–Ω–∞—è –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.',
            'variables': {'Ek‚ÇÅ, Ek‚ÇÇ': '–∫–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö 1 –∏ 2 (–î–∂)',
                         'Ep‚ÇÅ, Ep‚ÇÇ': '–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö 1 –∏ 2 (–î–∂)'}
        }
    },
    '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã': {
        '–ø–µ—Ä–∏–æ–¥ –∫–æ–ª–µ–±–∞–Ω–∏–π': {
            'formula': 'T = 1/ŒΩ',
            'description': '–ü–µ—Ä–∏–æ–¥ –∫–æ–ª–µ–±–∞–Ω–∏–π —Ä–∞–≤–µ–Ω –æ–±—Ä–∞—Ç–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω–µ —á–∞—Å—Ç–æ—Ç—ã.',
            'variables': {'T': '–ø–µ—Ä–∏–æ–¥ (—Å)', 'ŒΩ': '—á–∞—Å—Ç–æ—Ç–∞ (–ì—Ü)'}
        },
        '—á–∞—Å—Ç–æ—Ç–∞ –∫–æ–ª–µ–±–∞–Ω–∏–π': {
            'formula': 'ŒΩ = 1/T',
            'description': '–ß–∞—Å—Ç–æ—Ç–∞ –∫–æ–ª–µ–±–∞–Ω–∏–π —Ä–∞–≤–Ω–∞ –æ–±—Ä–∞—Ç–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω–µ –ø–µ—Ä–∏–æ–¥–∞.',
            'variables': {'ŒΩ': '—á–∞—Å—Ç–æ—Ç–∞ (–ì—Ü)', 'T': '–ø–µ—Ä–∏–æ–¥ (—Å)'}
        },
        '–ø–µ—Ä–∏–æ–¥ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—è—Ç–Ω–∏–∫–∞': {
            'formula': 'T = 2œÄ‚àö(l/g)',
            'description': '–ü–µ—Ä–∏–æ–¥ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—è—Ç–Ω–∏–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –Ω–∏—Ç–∏ –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è.',
            'variables': {'T': '–ø–µ—Ä–∏–æ–¥ (—Å)', 'l': '–¥–ª–∏–Ω–∞ –Ω–∏—Ç–∏ (–º)', 'g': '—É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è ‚âà 9,8 –º/—Å¬≤'}
        },
        '—Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ–ª–Ω—ã': {
            'formula': 'v = ŒªŒΩ',
            'description': '–°–∫–æ—Ä–æ—Å—Ç—å –≤–æ–ª–Ω—ã —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –¥–ª–∏–Ω—ã –≤–æ–ª–Ω—ã –Ω–∞ —á–∞—Å—Ç–æ—Ç—É.',
            'variables': {'v': '—Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ–ª–Ω—ã (–º/—Å)', 'Œª': '–¥–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã (–º)', 'ŒΩ': '—á–∞—Å—Ç–æ—Ç–∞ (–ì—Ü)'}
        }
    }
}

# ==================== –ë–ê–ó–ê –î–ê–ù–ù–´–• –û–ü–†–ï–î–ï–õ–ï–ù–ò–ô ====================

DEFINITIONS_DB = {
    '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞': {
        '—Å–∫–æ—Ä–æ—Å—Ç—å': '–°–∫–æ—Ä–æ—Å—Ç—å - —ç—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –≤–µ–ª–∏—á–∏–Ω–∞, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–∞—è –±—ã—Å—Ç—Ä–æ—Ç—É –¥–≤–∏–∂–µ–Ω–∏—è. –†–∞–≤–Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –ø—É—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–∏.',
        '—É—Å–∫–æ—Ä–µ–Ω–∏–µ': '–£—Å–∫–æ—Ä–µ–Ω–∏–µ - —ç—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –≤–µ–ª–∏—á–∏–Ω–∞, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–∞—è –±—ã—Å—Ç—Ä–æ—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏. –†–∞–≤–Ω–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–æ –≤—Ä–µ–º–µ–Ω–∏.',
        '—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ': '–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ - —ç—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é.',
        '—Ä–∞–≤–Ω–æ—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ': '–†–∞–≤–Ω–æ—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ - —ç—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º.',
        '—Å–≤–æ–±–æ–¥–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ': '–°–≤–æ–±–æ–¥–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ - —ç—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ —Ç–µ–ª–∞ –ø–æ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º —Ç–æ–ª—å–∫–æ —Å–∏–ª—ã —Ç—è–∂–µ—Å—Ç–∏.'
    },
    '–¥–∏–Ω–∞–º–∏–∫–∞': {
        '–ø–µ—Ä–≤—ã–π –∑–∞–∫–æ–Ω –Ω—å—é—Ç–æ–Ω–∞': '–¢–µ–ª–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–æ—è –∏–ª–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –Ω–∞ –Ω–µ–≥–æ –Ω–µ –¥–µ–π—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥–∏–µ —Ç–µ–ª–∞ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –¥—Ä—É–≥–∏—Ö —Ç–µ–ª —Å–∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ.',
        '–≤—Ç–æ—Ä–æ–π –∑–∞–∫–æ–Ω –Ω—å—é—Ç–æ–Ω–∞': '–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç–µ–ª–∞ –ø—Ä—è–º–æ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ä–∞–≤–Ω–æ–¥–µ–π—Å—Ç–≤—É—é—â–µ–π —Å–∏–ª, –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫ —Ç–µ–ª—É, –∏ –æ–±—Ä–∞—Ç–Ω–æ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –µ–≥–æ –º–∞—Å—Å–µ.',
        '—Ç—Ä–µ—Ç–∏–π –∑–∞–∫–æ–Ω –Ω—å—é—Ç–æ–Ω–∞': '–°–∏–ª—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –¥–≤–∞ —Ç–µ–ª–∞ –¥–µ–π—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞, —Ä–∞–≤–Ω—ã –ø–æ –º–æ–¥—É–ª—é –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é.',
        '—Å–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏': '–°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏ - —ç—Ç–æ —Å–∏–ª–∞, —Å –∫–æ—Ç–æ—Ä–æ–π –ó–µ–º–ª—è –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç —Ç–µ–ª–æ.',
        '—Å–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è': '–°–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è - —ç—Ç–æ —Å–∏–ª–∞, –≤–æ–∑–Ω–∏–∫–∞—é—â–∞—è –ø—Ä–∏ —Å–æ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–∏ —Ç–µ–ª –∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É—é—â–∞—è –∏—Ö –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º—É –¥–≤–∏–∂–µ–Ω–∏—é.'
    },
    '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è': {
        '–∏–º–ø—É–ª—å—Å': '–ò–º–ø—É–ª—å—Å —Ç–µ–ª–∞ - —ç—Ç–æ –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞, —Ä–∞–≤–Ω–∞—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –º–∞—Å—Å—ã —Ç–µ–ª–∞ –Ω–∞ –µ–≥–æ —Å–∫–æ—Ä–æ—Å—Ç—å.',
        '–∑–∞–∫–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–ø—É–ª—å—Å–∞': '–í –∑–∞–º–∫–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ –≤–µ–∫—Ç–æ—Ä–Ω–∞—è —Å—É–º–º–∞ –∏–º–ø—É–ª—å—Å–æ–≤ –≤—Å–µ—Ö —Ç–µ–ª –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –ø—Ä–∏ –ª—é–±—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö —Ç–µ–ª —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã –º–µ–∂–¥—É —Å–æ–±–æ–π.',
        '–º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞': '–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é —Å–∏–ª—ã –Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏ –∫–æ—Å–∏–Ω—É—Å —É–≥–ª–∞ –º–µ–∂–¥—É –Ω–∏–º–∏.',
        '–∫–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è': '–ö–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è - —ç—Ç–æ —ç–Ω–µ—Ä–≥–∏—è –¥–≤–∏–∂–µ–Ω–∏—è —Ç–µ–ª–∞.',
        '–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è': '–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è - —ç—Ç–æ —ç–Ω–µ—Ä–≥–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Ç–µ–ª –∏–ª–∏ —á–∞—Å—Ç–µ–π —Ç–µ–ª–∞.',
        '–∑–∞–∫–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏': '–í –∑–∞–º–∫–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ–ª–Ω–∞—è –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.'
    },
    '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã': {
        '–∫–æ–ª–µ–±–∞–Ω–∏—è': '–ö–æ–ª–µ–±–∞–Ω–∏—è - —ç—Ç–æ –¥–≤–∏–∂–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ—á–Ω–æ –∏–ª–∏ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏.',
        '–ø–µ—Ä–∏–æ–¥ –∫–æ–ª–µ–±–∞–Ω–∏–π': '–ü–µ—Ä–∏–æ–¥ –∫–æ–ª–µ–±–∞–Ω–∏–π - —ç—Ç–æ –≤—Ä–µ–º—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–ª–µ–±–∞–Ω–∏—è.',
        '—á–∞—Å—Ç–æ—Ç–∞ –∫–æ–ª–µ–±–∞–Ω–∏–π': '–ß–∞—Å—Ç–æ—Ç–∞ –∫–æ–ª–µ–±–∞–Ω–∏–π - —ç—Ç–æ —á–∏—Å–ª–æ –ø–æ–ª–Ω—ã—Ö –∫–æ–ª–µ–±–∞–Ω–∏–π –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏.',
        '–≤–æ–ª–Ω–∞': '–í–æ–ª–Ω–∞ - —ç—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–ª–µ–±–∞–Ω–∏–π –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏.',
        '–¥–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã': '–î–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã - —ç—Ç–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –±–ª–∏–∂–∞–π—à–∏–º–∏ —Ç–æ—á–∫–∞–º–∏, –∫–æ–ª–µ–±–ª—é—â–∏–º–∏—Å—è –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Ñ–∞–∑–µ.'
    }
}

# ==================== –ë–ê–ó–ê –î–ê–ù–ù–´–• –¢–ï–°–¢–û–í ====================

TESTS_DB = {
    '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞': [
        {
            'question': '–ß–µ–º—É —Ä–∞–≤–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏?',
            'options': ['v = s/t', 'v = at', 'v = v‚ÇÄ + at', 'v = gt'],
            'correct': 0
        },
        {
            'question': '–ö–∞–∫–æ–π —Ñ–æ—Ä–º—É–ª–æ–π –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è –ø—É—Ç—å –ø—Ä–∏ —Ä–∞–≤–Ω–æ—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –±–µ–∑ –Ω–∞—á–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏?',
            'options': ['s = vt', 's = at¬≤/2', 's = v‚ÇÄt + at¬≤/2', 's = v¬≤/(2a)'],
            'correct': 1
        },
        {
            'question': '–ß–µ–º—É —Ä–∞–≤–Ω–æ —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è –Ω–∞ –ó–µ–º–ª–µ?',
            'options': ['9,8 –º/—Å¬≤', '10 –º/—Å¬≤', '9,8 –º/—Å', '10 –º/—Å'],
            'correct': 0
        },
        {
            'question': '–ö–∞–∫–æ–π —Ñ–æ—Ä–º—É–ª–æ–π –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏ —Å–≤–æ–±–æ–¥–Ω–æ–º –ø–∞–¥–µ–Ω–∏–∏?',
            'options': ['v = s/t', 'v = at', 'v = gt', 'v = v‚ÇÄ + at'],
            'correct': 2
        },
        {
            'question': '–ß—Ç–æ —Ç–∞–∫–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ?',
            'options': ['–û—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—É—Ç–∏ –∫–æ –≤—Ä–µ–º–µ–Ω–∏', '–û—Ç–Ω–æ—à–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–æ –≤—Ä–µ–º–µ–Ω–∏', 
                       '–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ –≤—Ä–µ–º—è', '–û—Ç–Ω–æ—à–µ–Ω–∏–µ —Å–∏–ª—ã –∫ –º–∞—Å—Å–µ'],
            'correct': 1
        },
        {
            'question': '–ü—Ä–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç—å...',
            'options': ['–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è', '–£–º–µ–Ω—å—à–∞–µ—Ç—Å—è', '–û—Å—Ç–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π', '–ò–∑–º–µ–Ω—è–µ—Ç—Å—è –ø–æ –∑–∞–∫–æ–Ω—É'],
            'correct': 2
        },
        {
            'question': '–¶–µ–Ω—Ç—Ä–æ—Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ...',
            'options': ['–ü–æ –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ–π –∫ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏', '–ö —Ü–µ–Ω—Ç—Ä—É –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏', '–û—Ç —Ü–µ–Ω—Ç—Ä–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏', '–ü–æ —Ä–∞–¥–∏—É—Å—É'],
            'correct': 1
        }
    ],
    '–¥–∏–Ω–∞–º–∏–∫–∞': [
        {
            'question': '–ö–∞–∫ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π –∑–∞–∫–æ–Ω –ù—å—é—Ç–æ–Ω–∞?',
            'options': ['F = ma', 'F = mg', 'F = -kx', 'F = mv'],
            'correct': 0
        },
        {
            'question': '–°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:',
            'options': ['F = ma', 'F = mg', 'F = mv', 'F = mv¬≤/r'],
            'correct': 1
        },
        {
            'question': '–ö–∞–∫ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç—Å—è —Ç—Ä–µ—Ç–∏–π –∑–∞–∫–æ–Ω –ù—å—é—Ç–æ–Ω–∞?',
            'options': ['–°–∏–ª—ã —Ä–∞–≤–Ω—ã –ø–æ –º–æ–¥—É–ª—é –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é',
                       '–°–∏–ª–∞ —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –º–∞—Å—Å—ã –Ω–∞ —É—Å–∫–æ—Ä–µ–Ω–∏–µ',
                       '–¢–µ–ª–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–æ—è –∏–ª–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è',
                       '–°–∏–ª–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏'],
            'correct': 0
        },
        {
            'question': '–°–∏–ª–∞ —Ç—Ä–µ–Ω–∏—è —Å–∫–æ–ª—å–∂–µ–Ω–∏—è –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:',
            'options': ['F = ma', 'F = ŒºN', 'F = mg', 'F = -kx'],
            'correct': 1
        },
        {
            'question': '–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–µ—Ä—Ü–∏—è?',
            'options': ['–°–≤–æ–π—Å—Ç–≤–æ —Ç–µ–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å', '–°–∏–ª–∞ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—é',
                       '–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç–µ–ª–∞', '–≠–Ω–µ—Ä–≥–∏—è –¥–≤–∏–∂–µ–Ω–∏—è'],
            'correct': 0
        },
        {
            'question': '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è —Å–∏–ª—ã:',
            'options': ['–∫–≥', '–º/—Å', '–ù (–Ω—å—é—Ç–æ–Ω)', '–î–∂'],
            'correct': 2
        },
        {
            'question': '–ó–∞–∫–æ–Ω –ì—É–∫–∞ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–æ–π:',
            'options': ['F = ma', 'F = mg', 'F = -kx', 'F = mv'],
            'correct': 2
        }
    ],
    '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è': [
        {
            'question': '–ò–º–ø—É–ª—å—Å —Ç–µ–ª–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:',
            'options': ['p = mv', 'p = ma', 'p = F/t', 'p = mv¬≤/2'],
            'correct': 0
        },
        {
            'question': '–ö–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:',
            'options': ['Ek = mv', 'Ek = mv¬≤/2', 'Ek = mgh', 'Ek = Fs'],
            'correct': 1
        },
        {
            'question': '–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤ –ø–æ–ª–µ —Ç—è–∂–µ—Å—Ç–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:',
            'options': ['Ep = mv', 'Ep = mv¬≤/2', 'Ep = mgh', 'Ep = Fs'],
            'correct': 2
        },
        {
            'question': '–í –∑–∞–º–∫–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:',
            'options': ['–°–∫–æ—Ä–æ—Å—Ç—å', '–ò–º–ø—É–ª—å—Å', '–°–∏–ª–∞', '–£—Å–∫–æ—Ä–µ–Ω–∏–µ'],
            'correct': 1
        },
        {
            'question': '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏:',
            'options': ['–ù (–Ω—å—é—Ç–æ–Ω)', '–î–∂ (–¥–∂–æ—É–ª—å)', '–í—Ç (–≤–∞—Ç—Ç)', '–ü–∞ (–ø–∞—Å–∫–∞–ª—å)'],
            'correct': 1
        },
        {
            'question': '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏–º–ø—É–ª—å—Å–∞:',
            'options': ['–∫–≥¬∑–º/—Å', '–∫–≥¬∑–º/—Å¬≤', '–ù¬∑–º', '–î–∂'],
            'correct': 0
        },
        {
            'question': '–ó–∞–∫–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤ –¥–ª—è:',
            'options': ['–õ—é–±–æ–π —Å–∏—Å—Ç–µ–º—ã', '–ó–∞–º–∫–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã', '–û—Ç–∫—Ä—ã—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã', '–°–∏—Å—Ç–µ–º—ã —Å —Ç—Ä–µ–Ω–∏–µ–º'],
            'correct': 1
        }
    ],
    '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã': [
        {
            'question': '–ü–µ—Ä–∏–æ–¥ –∫–æ–ª–µ–±–∞–Ω–∏–π —Å–≤—è–∑–∞–Ω —Å —á–∞—Å—Ç–æ—Ç–æ–π —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º:',
            'options': ['T = ŒΩ', 'T = 1/ŒΩ', 'T = 2œÄŒΩ', 'T = ŒΩ/2œÄ'],
            'correct': 1
        },
        {
            'question': '–ü–µ—Ä–∏–æ–¥ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—è—Ç–Ω–∏–∫–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:',
            'options': ['T = 2œÄ‚àö(l/g)', 'T = 2œÄ‚àö(m/k)', 'T = 1/ŒΩ', 'T = l/v'],
            'correct': 0
        },
        {
            'question': '–°–∫–æ—Ä–æ—Å—Ç—å –≤–æ–ª–Ω—ã —Å–≤—è–∑–∞–Ω–∞ —Å –¥–ª–∏–Ω–æ–π –≤–æ–ª–Ω—ã –∏ —á–∞—Å—Ç–æ—Ç–æ–π —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º:',
            'options': ['v = Œª/ŒΩ', 'v = ŒªŒΩ', 'v = Œª + ŒΩ', 'v = Œª - ŒΩ'],
            'correct': 1
        },
        {
            'question': '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã:',
            'options': ['–ì—Ü (–≥–µ—Ä—Ü)', '—Å (—Å–µ–∫—É–Ω–¥–∞)', '–º/—Å', '—Ä–∞–¥/—Å'],
            'correct': 0
        },
        {
            'question': '–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–∏–æ–¥ –∫–æ–ª–µ–±–∞–Ω–∏–π?',
            'options': ['–ß–∏—Å–ª–æ –∫–æ–ª–µ–±–∞–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É', '–í—Ä–µ–º—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–ª–µ–±–∞–Ω–∏—è',
                       '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏', '–°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è'],
            'correct': 1
        },
        {
            'question': '–î–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã - —ç—Ç–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É:',
            'options': ['–î–≤—É–º—è –ª—é–±—ã–º–∏ —Ç–æ—á–∫–∞–º–∏', '–ë–ª–∏–∂–∞–π—à–∏–º–∏ —Ç–æ—á–∫–∞–º–∏ –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Ñ–∞–∑–µ',
                       '–ù–∞—á–∞–ª–æ–º –∏ –∫–æ–Ω—Ü–æ–º –≤–æ–ª–Ω—ã', '–î–≤—É–º—è –≥—Ä–µ–±–Ω—è–º–∏'],
            'correct': 1
        },
        {
            'question': '–ß–∞—Å—Ç–æ—Ç–∞ –∫–æ–ª–µ–±–∞–Ω–∏–π - —ç—Ç–æ:',
            'options': ['–í—Ä–µ–º—è –æ–¥–Ω–æ–≥–æ –∫–æ–ª–µ–±–∞–Ω–∏—è', '–ß–∏—Å–ª–æ –∫–æ–ª–µ–±–∞–Ω–∏–π –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏',
                       '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏', '–°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è'],
            'correct': 1
        }
    ]
}


# ==================== –§–£–ù–ö–¶–ò–ò –°–û–ó–î–ê–ù–ò–Ø –ö–õ–ê–í–ò–ê–¢–£–† ====================

def get_main_keyboard() -> InlineKeyboardMarkup:
    """–°–æ–∑–¥–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    keyboard = [
        [InlineKeyboardButton("üìê –ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞", callback_data="section_–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞")],
        [InlineKeyboardButton("‚öôÔ∏è –î–∏–Ω–∞–º–∏–∫–∞", callback_data="section_–¥–∏–Ω–∞–º–∏–∫–∞")],
        [InlineKeyboardButton("‚ö° –ó–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è", callback_data="section_–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")],
        [InlineKeyboardButton("üåä –ö–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã", callback_data="section_–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã")],
        [InlineKeyboardButton("‚ùì –ü–æ–º–æ—â—å", callback_data="help_menu")]
    ]
    return InlineKeyboardMarkup(keyboard)


def get_section_keyboard(section: str) -> InlineKeyboardMarkup:
    """–°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞"""
    keyboard = [
        [InlineKeyboardButton("üìê –§–æ—Ä–º—É–ª—ã", callback_data=f"mode_formulas_{section}")],
        [InlineKeyboardButton("üìñ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è", callback_data=f"mode_definitions_{section}")],
        [InlineKeyboardButton("üìù –ú–∏–Ω–∏-—Ç–µ—Å—Ç", callback_data=f"mode_test_{section}")],
        [InlineKeyboardButton("üîô –ù–∞–∑–∞–¥", callback_data="back_to_main")]
    ]
    return InlineKeyboardMarkup(keyboard)


def get_formulas_keyboard(section: str) -> InlineKeyboardMarkup:
    """–°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏ —Ä–∞–∑–¥–µ–ª–∞"""
    formulas = FORMULAS_DB.get(section, {})
    logger.info(f"–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Ñ–æ—Ä–º—É–ª –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}', –Ω–∞–π–¥–µ–Ω–æ —Ñ–æ—Ä–º—É–ª: {len(formulas)}")
    keyboard = []
    
    # –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
    section_map = {
        '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞': 'kin',
        '–¥–∏–Ω–∞–º–∏–∫–∞': 'dyn',
        '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è': 'zsoh',
        '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã': 'kol'
    }
    section_id = section_map.get(section, section[:3])
    
    for idx, key in enumerate(formulas.keys()):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
        callback = f"frm:{section_id}:{idx}"
        logger.debug(f"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Ñ–æ—Ä–º—É–ª—ã: {key}, callback_data: {callback}")
        keyboard.append([InlineKeyboardButton(f"üìê {key.title()}", callback_data=callback)])
    
    keyboard.append([InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª—É", callback_data=f"section_{section}")])
    logger.info(f"–°–æ–∑–¥–∞–Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å {len(keyboard)-1} –∫–Ω–æ–ø–∫–∞–º–∏ —Ñ–æ—Ä–º—É–ª")
    return InlineKeyboardMarkup(keyboard)


def get_definitions_keyboard(section: str) -> InlineKeyboardMarkup:
    """–°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏ —Ä–∞–∑–¥–µ–ª–∞"""
    definitions = DEFINITIONS_DB.get(section, {})
    logger.info(f"–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}', –Ω–∞–π–¥–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π: {len(definitions)}")
    keyboard = []
    
    # –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
    section_map = {
        '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞': 'kin',
        '–¥–∏–Ω–∞–º–∏–∫–∞': 'dyn',
        '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è': 'zsoh',
        '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã': 'kol'
    }
    section_id = section_map.get(section, section[:3])
    
    for idx, key in enumerate(definitions.keys()):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
        callback = f"def:{section_id}:{idx}"
        logger.debug(f"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è: {key}, callback_data: {callback}")
        keyboard.append([InlineKeyboardButton(f"üìñ {key.title()}", callback_data=callback)])
    
    keyboard.append([InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª—É", callback_data=f"section_{section}")])
    logger.info(f"–°–æ–∑–¥–∞–Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å {len(keyboard)-1} –∫–Ω–æ–ø–∫–∞–º–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π")
    return InlineKeyboardMarkup(keyboard)


# ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î ====================

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user = update.effective_user
    keyboard = get_main_keyboard()
    
    await update.message.reply_text(
        f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! üëã\n\n"
        "üìö –Ø SchoolHelperBot - –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ñ–∏–∑–∏–∫–µ –¥–ª—è 9 –∫–ª–∞—Å—Å–∞!\n\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º –∏–∑—É—á–∏—Ç—å:\n"
        "‚Ä¢ üìê –ö–∏–Ω–µ–º–∞—Ç–∏–∫—É (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –∏ —Ä–∞–≤–Ω–æ—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ)\n"
        "‚Ä¢ ‚öôÔ∏è –î–∏–Ω–∞–º–∏–∫—É (–ó–∞–∫–æ–Ω—ã –ù—å—é—Ç–æ–Ω–∞)\n"
        "‚Ä¢ ‚ö° –ó–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–∏–º–ø—É–ª—å—Å–∞ –∏ —ç–Ω–µ—Ä–≥–∏–∏)\n"
        "‚Ä¢ üåä –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∏–∑ –º–µ–Ω—é –Ω–∏–∂–µ:",
        reply_markup=keyboard
    )


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = """
üìö –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞

üîπ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã:

üìê –†–µ–∂–∏–º —Ñ–æ—Ä–º—É–ª - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞–∑–¥–µ–ª–∞ —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π –≤–µ–ª–∏—á–∏–Ω

üìñ –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π - –∫—Ä–∞—Ç–∫–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∑–∞–∫–æ–Ω–æ–≤ –∏ –ø–æ–Ω—è—Ç–∏–π

üìù –ú–∏–Ω–∏-—Ç–µ—Å—Ç - 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–µ –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

üîπ –ö–æ–º–∞–Ω–¥—ã:
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

üí° –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –∏ –∑–∞—Ç–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã!
    """
    keyboard = get_main_keyboard()
    await update.message.reply_text(help_text, reply_markup=keyboard)


# ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–ù–û–ü–û–ö ====================

async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏"""
    query = update.callback_query
    await query.answer()
    
    callback_data = query.data
    logger.info(f"–ü–æ–ª—É—á–µ–Ω callback_data: {callback_data}")
    
    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    if callback_data == "back_to_main":
        keyboard = get_main_keyboard()
        text = (
            "üìö SchoolHelperBot - –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ñ–∏–∑–∏–∫–µ 9 –∫–ª–∞—Å—Å–∞\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:"
        )
        await query.edit_message_text(text, reply_markup=keyboard)
        return
    
    # –í—ã–±–æ—Ä —Ä–∞–∑–¥–µ–ª–∞
    if callback_data.startswith("section_"):
        section = callback_data.replace("section_", "")
        keyboard = get_section_keyboard(section)
        
        section_names = {
            '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞': 'üìê –ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞',
            '–¥–∏–Ω–∞–º–∏–∫–∞': '‚öôÔ∏è –î–∏–Ω–∞–º–∏–∫–∞',
            '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è': '‚ö° –ó–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è',
            '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã': 'üåä –ö–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã'
        }
        
        text = f"{section_names.get(section, section)}\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:"
        await query.edit_message_text(text, reply_markup=keyboard)
        return
    
    # –†–µ–∂–∏–º —Ñ–æ—Ä–º—É–ª
    if callback_data.startswith("mode_formulas_"):
        section = callback_data.replace("mode_formulas_", "")
        logger.info(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∂–∏–º–∞ —Ñ–æ—Ä–º—É–ª –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞: '{section}'")
        
        formulas = FORMULAS_DB.get(section, {})
        logger.info(f"–ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ä–º—É–ª –≤ —Ä–∞–∑–¥–µ–ª–µ '{section}': {len(formulas)}")
        
        if not formulas:
            await query.answer("–§–æ—Ä–º—É–ª—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã", show_alert=True)
            return
        
        keyboard = get_formulas_keyboard(section)
        text = f"üìê –§–æ—Ä–º—É–ª—ã —Ä–∞–∑–¥–µ–ª–∞ '{section.title()}':\n\n"
        text += "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:"
        
        try:
            await query.edit_message_text(text, reply_markup=keyboard)
            logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}'")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}': {e}")
            try:
                await query.message.reply_text(text, reply_markup=keyboard)
                logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –Ω–æ–≤–æ–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}'")
            except Exception as e2:
                logger.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e2}")
                await query.answer(f"–û—à–∏–±–∫–∞: {str(e2)[:50]}", show_alert=True)
        return
    
    # –ü–æ–∫–∞–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ–æ—Ä–º—É–ª—ã
    if callback_data.startswith("frm:"):
        parts = callback_data.split(":", 2)
        if len(parts) == 3:
            section_map = {
                'kin': '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞',
                'dyn': '–¥–∏–Ω–∞–º–∏–∫–∞',
                'zsoh': '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è',
                'kol': '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã'
            }
            section_id = parts[1]
            formula_idx = int(parts[2])
            section = section_map.get(section_id, section_id)
            
            formulas = list(FORMULAS_DB.get(section, {}).keys())
            if 0 <= formula_idx < len(formulas):
                formula_key = formulas[formula_idx]
                formula_info = FORMULAS_DB.get(section, {}).get(formula_key)
            else:
                formula_info = None
            
            if formula_info:
                text = f"üìê *–§–æ—Ä–º—É–ª–∞:*\n`{formula_info['formula']}`\n\n"
                text += f"üìñ *–û–ø–∏—Å–∞–Ω–∏–µ:*\n{formula_info['description']}\n\n"
                text += "üìä *–û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:*\n"
                for var, desc in formula_info['variables'].items():
                    text += f"‚Ä¢ `{var}` - {desc}\n"
            else:
                text = f"–§–æ—Ä–º—É–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
            
            keyboard = InlineKeyboardMarkup([[
                InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ —Ñ–æ—Ä–º—É–ª–∞–º", callback_data=f"mode_formulas_{section}")
            ]])
            
            try:
                await query.edit_message_text(text, parse_mode='Markdown', reply_markup=keyboard)
            except:
                await query.edit_message_text(text.replace('*', '').replace('`', ''), reply_markup=keyboard)
        return
    
    # –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
    if callback_data.startswith("mode_definitions_"):
        section = callback_data.replace("mode_definitions_", "")
        logger.info(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∂–∏–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞: '{section}'")
        
        definitions = DEFINITIONS_DB.get(section, {})
        logger.info(f"–ù–∞–π–¥–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –≤ —Ä–∞–∑–¥–µ–ª–µ '{section}': {len(definitions)}")
        
        if not definitions:
            await query.answer("–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã", show_alert=True)
            return
        
        keyboard = get_definitions_keyboard(section)
        text = f"üìñ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ '{section.title()}':\n\n"
        text += "–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:"
        
        try:
            await query.edit_message_text(text, reply_markup=keyboard)
            logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}'")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}': {e}")
            try:
                await query.message.reply_text(text, reply_markup=keyboard)
                logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –Ω–æ–≤–æ–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ '{section}'")
            except Exception as e2:
                logger.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e2}")
                await query.answer(f"–û—à–∏–±–∫–∞: {str(e2)[:50]}", show_alert=True)
        return
    
    # –ü–æ–∫–∞–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    if callback_data.startswith("def:"):
        parts = callback_data.split(":", 2)
        if len(parts) == 3:
            section_map = {
                'kin': '–∫–∏–Ω–µ–º–∞—Ç–∏–∫–∞',
                'dyn': '–¥–∏–Ω–∞–º–∏–∫–∞',
                'zsoh': '–∑–∞–∫–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è',
                'kol': '–∫–æ–ª–µ–±–∞–Ω–∏—è –∏ –≤–æ–ª–Ω—ã'
            }
            section_id = parts[1]
            def_idx = int(parts[2])
            section = section_map.get(section_id, section_id)
            
            definitions = list(DEFINITIONS_DB.get(section, {}).keys())
            if 0 <= def_idx < len(definitions):
                def_key = definitions[def_idx]
                definition = DEFINITIONS_DB.get(section, {}).get(def_key)
            else:
                definition = None
            
            if definition:
                text = f"üìñ *{def_key.title()}*\n\n{definition}"
            else:
                text = "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ."
            
            keyboard = InlineKeyboardMarkup([[
                InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º", callback_data=f"mode_definitions_{section}")
            ]])
            
            try:
                await query.edit_message_text(text, parse_mode='Markdown', reply_markup=keyboard)
            except:
                await query.edit_message_text(text.replace('*', ''), reply_markup=keyboard)
        return
    
    # –†–µ–∂–∏–º —Ç–µ—Å—Ç–∞
    if callback_data.startswith("mode_test_"):
        section = callback_data.replace("mode_test_", "")
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ—Å—Ç
        tests = TESTS_DB.get(section, [])
        if not tests:
            await query.answer("–¢–µ—Å—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤—ã", show_alert=True)
            return
        
        # –í—ã–±–∏—Ä–∞–µ–º 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
        selected_tests = random.sample(tests, min(5, len(tests)))
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        context.user_data['current_test'] = {
            'section': section,
            'questions': selected_tests,
            'current_question': 0,
            'answers': [],
            'score': 0
        }
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
        await show_test_question(query, context)
        return
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞
    if callback_data.startswith("test_answer_"):
        parts = callback_data.split("_")
        if len(parts) >= 3:
            answer_index = int(parts[2])
            
            test_data = context.user_data.get('current_test')
            if not test_data:
                await query.answer("–¢–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω", show_alert=True)
                return
            
            current_q = test_data['current_question']
            question = test_data['questions'][current_q]
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
            test_data['answers'].append(answer_index)
            if answer_index == question['correct']:
                test_data['score'] += 1
                await query.answer("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!", show_alert=False)
            else:
                await query.answer(f"‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {question['options'][question['correct']]}", 
                                 show_alert=True)
            
            # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
            test_data['current_question'] += 1
            
            if test_data['current_question'] < len(test_data['questions']):
                await show_test_question(query, context)
            else:
                await show_test_results(query, context)
        return
    
    # –ü–æ–º–æ—â—å
    if callback_data == "help_menu":
        help_text = """
üìö –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞

üîπ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã:

üìê –†–µ–∂–∏–º —Ñ–æ—Ä–º—É–ª - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞–∑–¥–µ–ª–∞ —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π –≤–µ–ª–∏—á–∏–Ω

üìñ –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π - –∫—Ä–∞—Ç–∫–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∑–∞–∫–æ–Ω–æ–≤ –∏ –ø–æ–Ω—è—Ç–∏–π

üìù –ú–∏–Ω–∏-—Ç–µ—Å—Ç - 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–µ –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

üí° –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –∏ –∑–∞—Ç–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã!
        """
        keyboard = get_main_keyboard()
        await query.edit_message_text(help_text, reply_markup=keyboard)
        return


async def show_test_question(query, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞"""
    test_data = context.user_data.get('current_test')
    if not test_data:
        return
    
    current_q = test_data['current_question']
    question = test_data['questions'][current_q]
    
    text = f"üìù –í–æ–ø—Ä–æ—Å {current_q + 1} –∏–∑ {len(test_data['questions'])}\n\n"
    text += f"*{question['question']}*\n\n"
    
    keyboard_buttons = []
    for i, option in enumerate(question['options']):
        keyboard_buttons.append([
            InlineKeyboardButton(f"{chr(65+i)}. {option}", callback_data=f"test_answer_{i}")
        ])
    
    keyboard = InlineKeyboardMarkup(keyboard_buttons)
    
    try:
        await query.edit_message_text(text, parse_mode='Markdown', reply_markup=keyboard)
    except:
        await query.edit_message_text(text.replace('*', ''), reply_markup=keyboard)


async def show_test_results(query, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞"""
    test_data = context.user_data.get('current_test')
    if not test_data:
        return
    
    score = test_data['score']
    total = len(test_data['questions'])
    percentage = int((score / total) * 100)
    
    # –û—Ü–µ–Ω–∫–∞
    if percentage >= 80:
        grade = "–û—Ç–ª–∏—á–Ω–æ! üåü"
    elif percentage >= 60:
        grade = "–•–æ—Ä–æ—à–æ! üëç"
    elif percentage >= 40:
        grade = "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ üìö"
    else:
        grade = "–ù—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª üìñ"
    
    text = f"üìä *–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞*\n\n"
    text += f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {score} –∏–∑ {total}\n"
    text += f"–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {percentage}%\n\n"
    text += f"*{grade}*\n\n"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    text += "üìù –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:\n\n"
    for i, question in enumerate(test_data['questions']):
        user_answer = test_data['answers'][i]
        correct = question['correct']
        mark = "‚úÖ" if user_answer == correct else "‚ùå"
        text += f"{mark} –í–æ–ø—Ä–æ—Å {i+1}: {question['options'][correct]}\n"
    
    keyboard = InlineKeyboardMarkup([[
        InlineKeyboardButton("üîÑ –ü—Ä–æ–π—Ç–∏ –µ—â–µ —Ä–∞–∑", callback_data=f"mode_test_{test_data['section']}"),
        InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª—É", callback_data=f"section_{test_data['section']}")
    ]])
    
    # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞
    del context.user_data['current_test']
    
    try:
        await query.edit_message_text(text, parse_mode='Markdown', reply_markup=keyboard)
    except:
        await query.edit_message_text(text.replace('*', ''), reply_markup=keyboard)


# ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö –¢–ï–ö–°–¢–û–í–´–• –°–û–û–ë–©–ï–ù–ò–ô ====================

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    keyboard = get_main_keyboard()
    await update.message.reply_text(
        "üëã –ü—Ä–∏–≤–µ—Ç! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –±–æ—Ç—É.\n\n"
        "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.",
        reply_markup=keyboard
    )


# ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö ====================

async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
    error = context.error
    
    if "Conflict" in str(error) or "terminated by other getUpdates" in str(error):
        logger.error("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç: –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞!")
        return
    
    logger.error(f"Exception while handling an update: {error}", exc_info=error)


# ==================== –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ====================

def main() -> None:
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    application = Application.builder().token(BOT_TOKEN).build()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏
    application.add_handler(CallbackQueryHandler(button_callback))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    application.add_error_handler(error_handler)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    logger.info("–ë–æ—Ç SchoolHelperBot –∑–∞–ø—É—â–µ–Ω...")
    application.run_polling(allowed_updates=Update.ALL_TYPES)


if __name__ == '__main__':
    main()
